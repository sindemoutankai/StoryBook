<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Book Details</title>
  <style>
    body{{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;margin:0;background:#f6f6f6}}
    header{{padding:16px 20px;background:#fff;border-bottom:1px solid #eee;display:flex;gap:12px;align-items:center;flex-wrap:wrap}}
    h1{{font-size:16px;margin:0}}
    a{{color:#0b57d0;text-decoration:none}}
    .wrap{{max-width:1100px;margin:18px auto;padding:0 16px}}
    .grid{{display:grid;grid-template-columns:1fr 1fr;gap:14px}}
    .card{{background:#fff;border:1px solid #eee;border-radius:16px;padding:14px;box-shadow:0 1px 6px rgba(0,0,0,.04)}}
    pre{{white-space:pre-wrap;word-break:break-word;margin:0;font-size:12px;line-height:1.6}}
    .meta{{color:#666;font-size:13px;margin-top:6px}}
    @media (max-width:900px){{.grid{{grid-template-columns:1fr}}}}
  </style>
</head>
<body>
  <header>
    <h1 id="title">Book Details</h1>
    <a href="viewer.html">Webで読む</a>
    <a href="book.pdf" target="_blank" rel="noreferrer">PDF</a>
    <a href="../../index.html">本棚へ戻る</a>
  </header>

  <div class="wrap">
    <div class="card">
      <div class="meta" id="summary"></div>
    </div>

    <div class="grid">
      <section class="card">
        <h2 style="font-size:14px;margin:0 0 10px;">Prompt（prompt.txt）</h2>
        <pre id="prompt">(missing)</pre>
      </section>
      <section class="card">
        <h2 style="font-size:14px;margin:0 0 10px;">Transcript（transcript.txt）</h2>
        <pre id="transcript">(missing)</pre>
      </section>
    </div>
  </div>

  <script>
    async function safeFetchText(path){{
      const res = await fetch(path, {{ cache: "no-store" }});
      if(!res.ok) return "";
      return await res.text();
    }}

    async function init(){{
      const planRes = await fetch("book_plan.json", {{ cache: "no-store" }});
      if(!planRes.ok) throw new Error("book_plan.json が読めません");
      const plan = await planRes.json();

      document.getElementById("title").textContent = plan.title || "Book Details";
      document.getElementById("summary").textContent =
        `target_age: ${{plan.target_age || "-"}} / pages: ${{plan.page_count || (plan.pages ? plan.pages.length : "-")}}`;

      const prompt = await safeFetchText("prompt.txt");
      const transcript = await safeFetchText("transcript.txt");

      document.getElementById("prompt").textContent = prompt || "(prompt.txt がありません)";
      document.getElementById("transcript").textContent = transcript || "(transcript.txt がありません)";
    }}
    init().catch(err => {{ document.body.innerHTML = `<pre style="padding:20px">Error: ${{err.message}}</pre>`; }});
  </script>
</body>
</html>
